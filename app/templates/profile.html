{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div id="map-background"></div>

<div class="profile-container">
    <div class="profile-header">
        <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
        <div class="profile-actions">
            <a href="{{ url_for('index') }}" class="btn btn-primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ä—Ç–µ</a>
            <a href="{{ url_for('logout') }}" class="logout-link">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    <div class="profile-content">
        <div class="profile-section">
            <h2>–ú–æ–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</h2>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ:</label>
                    <select id="sort-select">
                        <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                        <option value="oldest">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>–§–∏–ª—å—Ç—Ä —ç–º–æ–¥–∑–∏:</label>
                    <div class="emoji-filter">
                        <button class="emoji-btn" data-emoji="üòä">üòä</button>
                        <button class="emoji-btn" data-emoji="üò¢">üò¢</button>
                        <button class="emoji-btn" data-emoji="üò°">üò°</button>
                        <button class="emoji-btn" data-emoji="üòé">üòé</button>
                        <button class="emoji-btn" data-emoji="ü•∞">ü•∞</button>
                        <button class="emoji-btn" data-emoji="üò¥">üò¥</button>
                        <button class="emoji-btn" data-emoji="ü§î">ü§î</button>
                        <button class="emoji-btn" data-emoji="üò∑">üò∑</button>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>–§–∏–ª—å—Ç—Ä –≤—Ä–µ–º–µ–Ω–∏:</label>
                    <div class="time-filters">
                        <button class="time-filter-btn" data-hours="1">1 —á–∞—Å</button>
                        <button class="time-filter-btn" data-hours="6">6 —á–∞—Å–æ–≤</button>
                        <button class="time-filter-btn" data-hours="24">24 —á–∞—Å–∞</button>
                        <button class="time-filter-btn" data-hours="72">3 –¥–Ω—è</button>
                    </div>
                </div>
            </div>
            
            <div class="moods-list" id="moods-list">
                {% if moods %}
                    {% for mood in moods %}
                        <div class="mood-card" data-emoji="{{ mood.emoji }}" data-timestamp="{{ mood.timestamp }}">
                            <div class="mood-emoji">{{ mood.emoji }}</div>
                            <div class="mood-details">
                                {% if mood.text %}
                                    <p class="mood-text">{{ mood.text }}</p>
                                {% endif %}
                                <p class="mood-time">{{ mood.formatted_time }}</p>
                            </div>
                            <button class="delete-mood" data-id="{{ mood.id }}">‚úï</button>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-moods">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –Ω–∞ –∫–∞—Ä—Ç–µ!</p>
                {% endif %}
            </div>
        </div>
        
        <div class="profile-section">
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">–í—Å–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π</div>
                    <div class="stat-value">{{ moods|length }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">–°–∞–º–æ–µ —á–∞—Å—Ç–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
                    <div class="stat-value" id="most-common-emoji">-</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã
        const mapBackground = L.map('map-background', {
            zoomControl: false,
            attributionControl: false,
            dragging: false,
            touchZoom: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            tap: false,
            keyboard: false
        });
        
        // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–∞—Ä—Ç—ã —Ñ–æ–Ω–∞
        if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    mapBackground.setView([position.coords.latitude, position.coords.longitude], 13);
                },
                function(error) {
                    mapBackground.setView([51.505, -0.09], 13);
                }
            );
        } else {
            mapBackground.setView([51.505, -0.09], 13);
        }
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(mapBackground);
        
        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ UTC timestamp –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.querySelectorAll('.mood-time').forEach(timeElement => {
            const timestamp = timeElement.closest('.mood-card').getAttribute('data-timestamp');
            if (timestamp) {
                timeElement.textContent = MoodMapUtils.formatDate(timestamp);
            }
        });
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        const moodsList = document.getElementById('moods-list');
        const sortSelect = document.getElementById('sort-select');
        const emojiButtons = document.querySelectorAll('.emoji-filter .emoji-btn');
        
        let activeEmojiFilters = [];
        let currentSort = 'newest';
        let activeTimeFilter = null;
        let allMoods = [];
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        fetchUserMoods();
        
        // –ü–æ–¥—Å—á–µ—Ç —Å–∞–º–æ–≥–æ —á–∞—Å—Ç–æ–≥–æ —ç–º–æ–¥–∑–∏
        updateMostCommonEmoji();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        sortSelect.addEventListener('change', function() {
            currentSort = this.value;
            sortMoods();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ —ç–º–æ–¥–∑–∏
        emojiButtons.forEach(button => {
            button.addEventListener('click', function() {
                const wasActive = this.classList.contains('active');
                const emoji = this.getAttribute('data-emoji');
                
                if (wasActive) {
                    // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    this.classList.remove('active');
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    this.classList.add('active');
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∫ –∏–º–µ—é—â–∏–º—Å—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è–º
                filterMoodsByEmoji();
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
        document.querySelectorAll('.time-filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                const wasActive = this.classList.contains('active');
                
                // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–æ—Å–∏–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('.time-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (!wasActive) {
                    this.classList.add('active');
                    activeTimeFilter = parseInt(this.getAttribute('data-hours'));
                } else {
                    activeTimeFilter = null;
                }
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏
                fetchUserMoods();
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function fetchUserMoods() {
            let url = '/api/user-moods';
            const params = new URLSearchParams();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –≤—Ä–µ–º–µ–Ω–∏, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω
            if (activeTimeFilter) {
                params.append('hours', activeTimeFilter);
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
            if (params.toString()) {
                url += '?' + params.toString();
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    allMoods = data;
                    displayMoods();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π:', error);
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π –ø–æ —ç–º–æ–¥–∑–∏
        function filterMoodsByEmoji() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã —ç–º–æ–¥–∑–∏
            const activeEmojiBtns = document.querySelectorAll('.emoji-filter .emoji-btn.active');
            const activeEmojis = Array.from(activeEmojiBtns).map(btn => btn.getAttribute('data-emoji'));
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
            filterAndDisplayMoods(activeEmojis);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
        function filterAndDisplayMoods(activeEmojis) {
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
            moodsList.innerHTML = '';
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º —ç–º–æ–¥–∑–∏
            const filteredMoods = activeEmojis.length === 0 
                ? allMoods 
                : allMoods.filter(mood => activeEmojis.includes(mood.emoji));
            
            if (filteredMoods.length === 0) {
                moodsList.innerHTML = '<p class="no-moods">–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É.</p>';
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
                document.querySelector('.stat-card .stat-value').textContent = '0';
                document.getElementById('most-common-emoji').textContent = '-';
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
            filteredMoods.forEach(mood => {
                const card = document.createElement('div');
                card.className = 'mood-card';
                card.setAttribute('data-emoji', mood.emoji);
                card.setAttribute('data-timestamp', mood.timestamp);
                
                card.innerHTML = `
                    <div class="mood-emoji">${mood.emoji}</div>
                    <div class="mood-details">
                        ${mood.text ? '<p class="mood-text">' + mood.text + '</p>' : ''}
                        <p class="mood-time">${MoodMapUtils.formatDate(mood.timestamp)}</p>
                    </div>
                    <button class="delete-mood" data-id="${mood.id}">‚úï</button>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è
                card.querySelector('.delete-mood').addEventListener('click', function() {
                    const moodId = this.getAttribute('data-id');
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?')) {
                        deleteMood(moodId);
                    }
                });
                
                moodsList.appendChild(card);
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
            sortMoods();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateMostCommonEmoji();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
        function displayMoods() {
            // –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏
            const activeEmojiBtns = document.querySelectorAll('.emoji-filter .emoji-btn.active');
            const activeEmojis = Array.from(activeEmojiBtns).map(btn => btn.getAttribute('data-emoji'));
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
            filterAndDisplayMoods(activeEmojis);
        }
        
        function sortMoods() {
            const moodCards = Array.from(document.querySelectorAll('.mood-card'));
            
            moodCards.sort((a, b) => {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º MoodMapUtils –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
                const timestampA = MoodMapUtils.convertToUserTimezone(a.getAttribute('data-timestamp')).getTime();
                const timestampB = MoodMapUtils.convertToUserTimezone(b.getAttribute('data-timestamp')).getTime();
                
                if (currentSort === 'newest') {
                    return timestampB - timestampA;
                } else {
                    return timestampA - timestampB;
                }
            });
            
            // –û—á–∏—Å—Ç–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            const cardsContainer = document.getElementById('moods-list');
            let visibleCount = 0;
            
            // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            while (cardsContainer.firstChild) {
                cardsContainer.removeChild(cardsContainer.firstChild);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            moodCards.forEach(card => {
                if (card.style.display !== 'none') {
                    cardsContainer.appendChild(card);
                    visibleCount++;
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
            if (visibleCount === 0) {
                cardsContainer.innerHTML = '<p class="no-moods">–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É.</p>';
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateMostCommonEmoji();
        }
        
        function deleteMood(moodId) {
            fetch(`/api/moods/${moodId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    // –£–¥–∞–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–∑ –º–∞—Å—Å–∏–≤–∞ allMoods
                    allMoods = allMoods.filter(mood => mood.id !== parseInt(moodId));
                    
                    // –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ DOM
                    const card = document.querySelector(`.mood-card button[data-id="${moodId}"]`).closest('.mood-card');
                    card.remove();
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –µ—â–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
                    if (allMoods.length === 0) {
                        moodsList.innerHTML = '<p class="no-moods">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –Ω–∞ –∫–∞—Ä—Ç–µ!</p>';
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    updateMostCommonEmoji();
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
                    const totalMoodsElement = document.querySelector('.stat-value');
                    totalMoodsElement.textContent = allMoods.length.toString();
                } else {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.');
            });
        }
        
        function updateMostCommonEmoji() {
            const visibleCards = document.querySelectorAll('.mood-card:not([style*="display: none"])');
            const emojiCounts = {};
            let maxCount = 0;
            let mostCommonEmoji = '-';
            
            visibleCards.forEach(card => {
                const emoji = card.getAttribute('data-emoji');
                
                if (!emojiCounts[emoji]) {
                    emojiCounts[emoji] = 0;
                }
                
                emojiCounts[emoji]++;
                
                if (emojiCounts[emoji] > maxCount) {
                    maxCount = emojiCounts[emoji];
                    mostCommonEmoji = emoji;
                }
            });
            
            document.getElementById('most-common-emoji').textContent = mostCommonEmoji;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
            document.querySelector('.stat-card .stat-value').textContent = visibleCards.length.toString();
        }
    });
</script>
{% endblock %}

{% block extra_css %}
{% endblock %} 